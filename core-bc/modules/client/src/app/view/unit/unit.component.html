<app-menu-title-row>

  <div class="menu-title-item">
    <div class="breadcrumbs">
      <a routerLink="../..">{{management}}</a>
      <app-chevron-right></app-chevron-right>
      <a routerLink="..">{{clinic?.name}}</a>
      <app-chevron-right></app-chevron-right>
      {{unit?.name}}
    </div>
  </div>

  <div class="menu-title-item right">
      <app-dashboard-menu [unit]="unit" type="unit-dashboard"></app-dashboard-menu>
  </div>

</app-menu-title-row>

<app-row>
  <app-left-column>

      <div>
      <vgr-page-block *ngIf="unit" class="{{showChangeBedOrder ? '' : 'transparent'}}">
        <div>
          <div *ngIf="showChangeBedOrder">
            <p>Dra och släpp sängarna och spara sedan.</p>
            <div dragula="ROWS" [(dragulaModel)]="bedsOrder">
              <div class="order-row" *ngFor="let bed of unit.beds">
                {{bed.label}} <span class="ssk-color ssk-{{bed.ssk?.color}}"></span>
              </div>
            </div>

            <div class="button-row">
              <vgr-save-cancel [hideLock]="true" (save)="saveBedOrder()"
                               (cancel)="hideChangeBedOrder()"></vgr-save-cancel>
            </div>
          </div>

          <div *ngIf="!showChangeBedOrder" class="bed-table-wrapper">
            <app-bed-table *ngIf="clinic && unit" [clinic]="clinic" [unit]="unit" (save)="ngOnInit()"></app-bed-table>

            <div class="button-row" style="padding: 0 0 16px 16px">
              <vgr-button (click)="changeBedOrder()">Byt ordning</vgr-button>
            </div>
          </div>
        </div>

      </vgr-page-block>

      <vgr-page-block *ngIf="unit?.patients.length > 0">
        <vgr-list [flexibleHeader]="true">

          <vgr-list-header>
            <vgr-list-column-header width="10">Permission / teknisk plats</vgr-list-column-header>
          </vgr-list-header>

          <vgr-list-item *ngFor="let patient of unit?.patients" #leavePatientItem>
            <vgr-list-item-header>
              <vgr-list-column width="5">{{patient.label}}</vgr-list-column>
              <vgr-list-column width="5">{{format(patient.leaveStatus)}}</vgr-list-column>
            </vgr-list-item-header>

            <vgr-list-item-content>
              Välj ledig säng
              <vgr-dropdown-select noItemSelectedLabel="Välj..." [(ngModel)]="chosenVacantBedId">
                <vgr-dropdown-item *ngFor="let item of vacantBeds" [value]="item.value">{{item.displayName}}</vgr-dropdown-item>
              </vgr-dropdown-select>

              <div class="button-row">
                <vgr-button (click)="chooseBedForLeavePatient(patient); collapse(leavePatientItem)">Spara</vgr-button>
              </div>

            </vgr-list-item-content>
          </vgr-list-item>
        </vgr-list>
      </vgr-page-block>
      <vgr-page-block *ngIf="unit?.hasUnitPlannedInFeature">
        <h6>Planerade in närmaste 8 dagarna:{{unit.name}}</h6>
        <div>
          <app-unit-planned-in-table #thisUnitPlannedInTable [unit]="unit"></app-unit-planned-in-table>
        </div>
        <h6 *ngIf="units?.length > 0">Planerade in närmaste 8 dagarna:Övriga avdelningar</h6>
        <div class="containers">
          <div *ngFor="let unit of units">
            <app-unit-planned-in-table [unit]="unit" ></app-unit-planned-in-table>
          </div>
        </div>
      </vgr-page-block>
        <vgr-page-block *ngIf="unit?.hasUnitPlannedInFeature">
          <vgr-list [flexibleHeader]="true">
            <vgr-list-item #plannedunit>
              <vgr-list-item-header>
                <vgr-list-column width="6">
                  <div>Planerade patienter från andra enheter</div>
                </vgr-list-column>
              </vgr-list-item-header>
              <vgr-list-item-content [indentContent]="true">
                <app-unit-planned-in-items #unitPlannedInItems *ngIf="unit !== null" [unit]="unit" [clinic]="clinic" (cancelPlaningUnitEvent)="collapse(plannedunit)" (savePlaningUnitEvent)="collapse(plannedunit); onUnitPlannedInItemsSave();"></app-unit-planned-in-items>
                  </vgr-list-item-content>

                </vgr-list-item>
                <vgr-list-item #oldplannedunit>
                  <vgr-list-item-header>
                    <vgr-list-column width="8">
                      <div>Gamla poster: Planerade patienter från andra enheter</div>
                    </vgr-list-column>
                  </vgr-list-item-header>
                  <vgr-list-item-content [indentContent]="true">
                    <app-unit-planned-in-items #unitPlannedInItemsOld *ngIf="unit !== null" [unit]="unit" [clinic]="clinic" [oldPost]="true" [showPlus]="true" (cancelPlaningUnitEvent)="collapse(oldplannedunit)" (savePlaningUnitEvent)="collapse(oldplannedunit);onUnitPlannedInItemsSave();"></app-unit-planned-in-items>
                  </vgr-list-item-content>

                </vgr-list-item>
                <vgr-list-item>
                  <vgr-list-item-header>
                    <vgr-list-column width="8">
                      <div>Vårdtyngd med text värde: Alternativ 2</div>
                    </vgr-list-column>
                  </vgr-list-item-header>
                  <vgr-list-item-content [indentContent]="true">
                    <app-widget-careburden-with-text-compact-alt [burdenvals]="burdenvals" [unit]="unit" [sskCategoryValueMatrix]="sskCategoryValueMatrix"></app-widget-careburden-with-text-compact-alt>
                  </vgr-list-item-content>
                </vgr-list-item>
              </vgr-list>
            </vgr-page-block>
          <vgr-page-block *ngIf="!unit">
            <div *ngIf="!error">
              <vgr-loader [small]="false"></vgr-loader>
            </div>

            <div *ngIf="error">
              <div class="alert">{{error}}</div>
            </div>
          </vgr-page-block>
        </div>
  </app-left-column>

  <app-right-column>
      <vgr-page-block class="transparent">

        <vgr-panel-container>
            <vgr-panel width="12" themecolor="green">
              <app-widget-messages [messages]="messages" [hasEditUnitPermission]="hasEditUnitPermission()"></app-widget-messages>
            </vgr-panel>
        </vgr-panel-container>

        <vgr-panel-container *ngIf="unit?.hasMotherChildDietFeature || unit?.hasKostFeature">
            <vgr-panel width="12">
                <app-widget-diet-list [clinic]="clinic" [unit]="unit"></app-widget-diet-list>
            </vgr-panel>
        </vgr-panel-container>

        <vgr-panel-container *ngIf="unit?.ssks.length > 0">
            <vgr-panel width="12">
                <app-widget-ssks [unit]="unit"></app-widget-ssks>
            </vgr-panel>
        </vgr-panel-container>          

        <vgr-panel-container *ngIf="unit?.hasCareBurdenWithAverage">
          <vgr-panel width="12">
              <app-widget-careburden-average [unit]="unit" [bedsExpanded]="false"></app-widget-careburden-average>
          </vgr-panel>
        </vgr-panel-container>                  

        <vgr-panel-container *ngIf="unit?.hasCareBurdenWithText">
          <vgr-panel width="12">
              <app-widget-careburden-with-text [burdenvals]="burdenvals" [unit]="unit" [sskCategoryValueMatrix]="sskCategoryValueMatrix"></app-widget-careburden-with-text>
          </vgr-panel>
        </vgr-panel-container>                  

      </vgr-page-block>
  </app-right-column>
</app-row>
